<!DOCTYPE html>
<html>
<head>
    <title>Mercator Projection Aspects</title>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-geo-projection@4"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/3.0.2/topojson.min.js"></script>
    <style>
        body {
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: system-ui, -apple-system, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        #mapContainer {
            width: 800px;
            height: 500px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }
        .controls {
            margin: 20px 0;
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .lat-control { color: #0066cc; }
        .lon-control { color: #9932cc; }
        input[type="range"] {
            width: 200px;
        }
    </style>
</head>
<body>
    <h1>Mercator Projection Aspects</h1>
    <div class="controls">
        <div class="control-group">
            <label>
                Aspect Angle (0° = Standard, 90° = Transverse):
                <input type="range" id="rotation" min="0" max="90" value="0" step="10">
            </label>
            <span id="rotationValue">0°</span>
        </div>
        <div class="control-group lat-control">
            <label>
                Central Latitude:
                <input type="range" id="latitude" min="-90" max="90" value="0" step="1">
            </label>
            <span id="latValue">0°</span>
        </div>
        <div class="control-group lon-control">
            <label>
                Central Longitude:
                <input type="range" id="longitude" min="-180" max="180" value="0" step="1">
            </label>
            <span id="lonValue">0°</span>
        </div>
    </div>
    <div id="mapContainer"></div>
    <script>
        const container = document.getElementById('mapContainer');
        const width = container.offsetWidth;
        const height = container.offsetHeight;
        let land;
        let projection;

        function createMap(rotation, lat, lon) {
            container.innerHTML = '';
            const canvas = document.createElement('canvas');
            canvas.width = width;
            canvas.height = height;
            container.appendChild(canvas);

            const context = canvas.getContext('2d');
            const graticule = d3.geoGraticule10();
            const outline = {type: "Sphere"};

            lon = ((lon + 180) % 360) - 180;

            if (rotation === 0) {
                projection = d3.geoMercator()
                    .scale(width / (2 * Math.PI))
                    .translate([width / 2, height / 2])
                    .rotate([-lon, 0])
                    .center([0, lat]);
            } else {
                projection = d3.geoTransverseMercator()
                    .scale(width / (2 * Math.PI))
                    .translate([width / 2, height / 2])
                    .rotate([-lon, -lat, rotation]);
            }

            const path = d3.geoPath(projection, context);

            renderMap(context, path, graticule, outline, lat, lon);
        }

        function renderMap(context, path, graticule, outline, lat, lon) {
            context.save();
            context.beginPath();
            path(outline);
            context.clip();
            context.fillStyle = "#fff";
            context.fillRect(0, 0, width, height);

            context.beginPath();
            path(land);
            context.fillStyle = "#999";
            context.fill();

            context.beginPath();
            path(graticule);
            context.strokeStyle = "#888";
            context.stroke();


            // Draw reference lines on the map
            if (lat !== undefined) {
                context.beginPath();
                path({type: "LineString", coordinates: [[-179, 0], [0, 0]]});
                path({type: "LineString", coordinates: [[0, 0], [179, 0]]});
                context.strokeStyle = "blue";
                context.setLineDash([5, 5]);
                context.stroke();
                context.setLineDash([]);
            }

            if (lon !== undefined) {
                context.beginPath();
                path({type: "LineString", coordinates: [[lon, -90], [lon, 90]]});
                context.strokeStyle = "purple";
                context.setLineDash([5, 5]);
                context.stroke();
                context.setLineDash([]);
            }

            context.restore();
            context.beginPath();
            path(outline);
            context.strokeStyle = "#000";
            context.stroke();
        }

        const slider = document.getElementById('rotation');
        const rotationValue = document.getElementById('rotationValue');
        const latSlider = document.getElementById('latitude');
        const latValue = document.getElementById('latValue');
        const lonSlider = document.getElementById('longitude');
        const lonValue = document.getElementById('lonValue');

        function updateMap() {
            const rotation = parseInt(slider.value);
            const lat = parseInt(latSlider.value);
            const lon = parseInt(lonSlider.value);
            rotationValue.textContent = `${rotation}°`;
            latValue.textContent = `${lat}°`;
            lonValue.textContent = `${lon}°`;
            createMap(rotation, lat, lon);
        }

        slider.addEventListener('input', updateMap);
        latSlider.addEventListener('input', updateMap);
        lonSlider.addEventListener('input', updateMap);

        d3.json('https://cdn.jsdelivr.net/npm/world-atlas@2/land-50m.json')
            .then(world => {
                land = topojson.feature(world, world.objects.land);
                updateMap();
            });
    </script>
</body>
</html>